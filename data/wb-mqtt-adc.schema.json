{
    "type": "object",
    "title": "ADC Driver Configuration",
    "description": "Controller analog inputs configuration",

    "configFile": {
        "path": "/etc/wb-mqtt-adc.conf",
        "service": "wb-mqtt-adc"
    },

    "definitions": {
        "adc_channel": {
            "type": "object",
            "properties": {
                "id": {
                    "type": "string",
                    "title": "MQTT id",
                    "propertyOrder": 1
                },
                "scale": {
                    "type": "number",
                    "title": "Internal ADC scale",
                    "default": 0,
                    "description": "scale_description",
                    "propertyOrder": 10
                },
                "voltage_multiplier": {
                    "type": "number",
                    "title": "Scale factor",
                    "default": 1,
                    "description": "voltage_multiplier_description",
                    "propertyOrder": 3
                },
                "averaging_window": {
                    "type": "integer",
                    "minimum": 1,
                    "title": "Averaging window",
                    "description": "Number of samples to use while calculating moving average",
                    "propertyOrder": 4
                },
                "decimal_places": {
                    "type": "integer",
                    "minimum": 0,
                    "title": "Decimal places in value",
                    "propertyOrder": 5
                },
                "max_voltage": {
                    "type": "number",
                    "title": "Overvoltage threshold (V)",
                    "propertyOrder": 6
                },
                "match_iio": {
                    "type": "string",
                    "title": "IIO device match pattern",
                    "description": "Fnmatch-compatible pattern to match with iio:deviceN symlink target",
                    "propertyOrder": 9
                },
                "poll_interval": {
                    "type": "integer",
                    "title": "Channel poll interval (ms)",
                    "default": 700,
                    "minimum": 1,
                    "description": "Delay between channel value publications",
                    "propertyOrder": 11
                },
                "delay_between_measurements": {
                    "type": "integer",
                    "title": "Averaging interval (ms)",
                    "default": 10,
                    "minimum": 1,
                    "description": "Delay between individual channel reads while averaging",
                    "propertyOrder": 12
                },
                "readings_number": {
                    "type": "integer",
                    "title": "(deprecated) Number of ADC reading per sample",
                    "minimum": 1,
                    "description": "Is not used. Use averaging window and poll interval instead of this",
                    "propertyOrder": 100
                }
            },
            "required": ["id", "voltage_multiplier"]
        },

        "iio_channel_base": {
            "type": "object",
            "options": {
                "disable_edit_json": true,
                "disable_collapse": true
            },
            "properties": {
                "channel_number": {
                    "title": "SoC channel",
                    "propertyOrder": 2,
                    "oneOf": [
                        {
                            "type": "string",
                            "description": "example: \"voltage10\" coresponds to \"in_voltage10\"",
                            "minLength": 1
                        },
                        {
                            "type": "integer",
                            "description": "(deprecated) \"10\" coresponds to \"in_voltage10\"",
                            "minimum": 0
                        }
                    ]
                }
            },

            "defaultProperties": [
                "channel_number",
                "voltage_multiplier",
                "id",
                "poll_interval"
            ],
            "required": ["channel_number"]
        },

        "iio_channel": {
            "headerTemplate": "ADC channel {{ |self.channel_number|}} {{(|self.id|)}}",
            "allOf": [
                {
                    "$ref": "#/definitions/iio_channel_base"
                },
                { "$ref": "#/definitions/adc_channel" }
            ]
        }
    },

    "properties": {
        "device_name": {
            "type": "string",
            "title": "MQTT device name",
            "default": "ADCs",
            "propertyOrder": 1
        },
        "debug": {
            "type": "boolean",
            "title": "Enable debug logging",
            "default": false,
            "_format": "checkbox",
            "propertyOrder": 2
        },
        "iio_channels": {
            "type": "array",
            "title": "List of SoC channels",
            "items": {
                "$ref": "#/definitions/iio_channel"
            },
            "_format": "tabs",
            "propertyOrder": 3,
            "options": {
                "disable_collapse": true
            }
        },
        "max_unchanged_interval": {
            "type": "integer",
            "title": "Unchanged value posting interval (s)",
            "description": "max_unchanged_interval_description",
            "default": 60,
            "minimum": 5,
            "propertyOrder": 4
        }
    },
    "required": ["device_name", "iio_channels"],

    "translations": {
        "en": {
            "scale_description": "The ADC scale to use. This setting asks hardware to use the specified scale. The closest supported scale (from _scale_available list) will be used. This doesn't affect the final value, but, instead would affect the accuracy and the measurement range. If left 0, the maximum available scale is used",
            "voltage_multiplier_description": "The ADC voltage is multiplied to this factor to get the resulting value",
            "max_unchanged_interval_description": "Specifies the maximum interval in seconds between posting the same values to message queue. Regardless of this setting, new values will be immediately published on change"
        },
        "ru": {
            "ADC Driver Configuration": "Аналоговые входы",
            "Controller analog inputs configuration": "Конфигурация аналоговых входов контроллера",
            "MQTT id": "Название канала MQTT",
            "Internal ADC scale": "Внутренний множитель АЦП",
            "scale_description": "Множитель не влияет на конечное значение, он определяет точность и диапазон измерения. Будет выбран ближайший из поддерживаемых множителей. Число 0 задает максимальный доступный множитель",
            "Scale factor": "Масштабирующий коэффициент",
            "voltage_multiplier_description": "Для получения итогового значения напряжение АЦП умножается на заданный коэффициент",
            "Averaging window": "Окно усреднения",
            "Number of samples to use while calculating moving average": "Количество выборок, используемых для усреднения значения",
            "Decimal places in value": "Число десятичных знаков у итогового значения",
            "Overvoltage threshold (V)": "Максимальное входное напряжение (В)",
            "IIO device match pattern": "Шаблон соответствия устройству IIO",
            "Fnmatch-compatible pattern to match with iio:deviceN symlink target": "Шаблон соотвествия с целью символической ссылки iio:устройствоN",
            "Channel poll interval (ms)": "Период опроса канала (мс)",
            "Delay between channel value publications": "Задержка между публикациями значений канала",
            "Averaging interval (ms)": "Интервал усреднения (мс)",
            "Delay between individual channel reads while averaging": "Интервал между опросами канала при усреднении",
            "(deprecated) Number of ADC reading per sample": "(устаревшее) Количество чтений данных АЦП при опросе",
            "Is not used. Use averaging window and poll interval instead of this": "Не используется. Используйте параметры \"Окно усреднения\" и \"Период опроса\"",
            "SoC channel": "Имя физического канала SoC",
            "example: \"voltage10\" coresponds to \"in_voltage10\"": "например: \"voltage10\" соответствует \"in_voltage10\"",
            "(deprecated) \"10\" coresponds to \"in_voltage10\"": "(устаревшее) \"10\" соответствует \"in_voltage10\"",
            "MQTT device name": "Имя устройства MQTT",
            "Enable debug logging": "Включить отладочные сообщения",
            "List of SoC channels": "Список каналов аналогового ввода",
            "Unchanged value posting interval (s)": "Интервал публикации неизменившегося значения (с)",
            "max_unchanged_interval_description": "Задает интервал публикации значения, если оно не изменилось. При изменении значения данные публикуются всегда незамедлительно",
            "ADC channel {{ |self.channel_number|}} {{(|self.id|)}}": "Канал АЦП {{ |self.channel_number|}} {{(|self.id|)}}"
        }
    }
}
